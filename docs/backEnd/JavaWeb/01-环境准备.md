# ç¯å¢ƒå‡†å¤‡

## åˆå§‹åŒ–æ•°æ®åº“

åˆ›å»ºæ•°æ®åº“

```sql
create database javaweb;
```

åˆ›å»ºè¡¨

```sql
-- ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
-- å­˜å‚¨å¼•æ“è®¾ç½®ä¸º InnoDBï¼Œæ”¯æŒ äº‹åŠ¡ (Transaction)ï¼Œä¿è¯æ•°æ®å®‰å…¨æ€§ï¼ˆå¦‚è½¬è´¦æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼‰ã€‚æ”¯æŒ è¡Œçº§é”ï¼Œå¹¶å‘æ€§èƒ½å¥½ã€‚æ”¯æŒ å¤–é”®çº¦æŸï¼Œè¡¨ä¸è¡¨ä¹‹é—´å¯ä»¥å»ºç«‹å¤–é”®å…³ç³»ã€‚
-- utf8mb4 æ˜¯ MySQL é‡ŒçœŸæ­£çš„ å®Œæ•´ UTF-8 å®ç°ï¼Œæ”¯æŒæ‰€æœ‰ Unicode å­—ç¬¦

CREATE TABLE goods (
    id INT AUTO_INCREMENT PRIMARY KEY COMMENT 'å”¯ä¸€ID',
    fname VARCHAR(100) NOT NULL COMMENT 'åå­—',
    price DECIMAL(10,2) NOT NULL COMMENT 'ä»·æ ¼',
    fcont INT NOT NULL COMMENT 'åº“å­˜æ•°é‡',
    remark VARCHAR(255) COMMENT 'æè¿°'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

```

æ’å…¥æ•°æ®

```sql
INSERT INTO goods (fname, price, fcont, remark) VALUES
('è‹¹æœ', 3.50, 100, 'æ–°é²œçš„çº¢å¯Œå£«è‹¹æœ'),
('æ¢¨', 2.80, 80, 'é¦™ç”œå¤šæ±çš„é›ªæ¢¨'),
('æ¡ƒå­', 5.20, 60, 'æ°´èœœæ¡ƒï¼Œå…¥å£å³åŒ–'),
('é¦™è•‰', 4.00, 120, 'è¿›å£é¦™è•‰ï¼Œå£æ„Ÿé¦™ç”œ'),
('æ©™å­', 3.80, 90, 'ç»´Cä¸°å¯Œçš„æ©™å­'),
('è¥¿ç“œ', 15.00, 30, 'å¤§è¥¿ç“œï¼Œæ¸…å‡‰è§£æš‘');
```

## æ•°æ®åº“è¿æ¥æ± 

**druidä½¿ç”¨æ­¥éª¤ï¼š**

```ts
1 æŠŠdruid-1.1.10.jaråŒ…æ”¾åœ¨libæ–‡ä»¶å¤¹ä¸­ã€‚
2 ç„¶åæŠŠè¿™ä¸ªæ–‡ä»¶å¤¹ä½œä¸ºä¸€ä¸ª libæ–‡ä»¶å¤¹ã€‚
3 æ‰‹åŠ¨å¯¼å…¥libåˆ°é¡¹ç›®ä¸­ã€‚
3 å¦‚æœé¡¹ç›®ä¸­è¦ç”¨ï¼Œç‚¹å‡»é¡¹ç›®çš„åç§°ç„¶å project Strutureé¡µé¢ï¼Œé€‰æ‹©Modulesï¼Œåœ¨Dependenciesé€‰é¡¹å¡ä¸­ï¼Œç‚¹å‡»å³ä¾§çš„åŠ å·ï¼Œé€‰æ‹©å¯¼å…¥çš„libraries
```

## é¡¹ç›®åˆ†å±‚

åœ¨ Java é¡¹ç›®é‡Œç»å¸¸çœ‹åˆ°ä¸€ä¸ªå« **`pojo`** çš„æ–‡ä»¶å¤¹ï¼Œå®ƒä¸æ˜¯ Java å®˜æ–¹è§„å®šçš„ï¼Œè€Œæ˜¯å¤§å®¶çº¦å®šä¿—æˆçš„ä¸€ç§ç›®å½•åã€‚

**pojoçš„å«ä¹‰**

- **POJO** = **Plain Old Java Object**ï¼Œç¿»è¯‘ä¸ºâ€œç®€å•çš„ Java å¯¹è±¡â€ã€‚
- ç‰¹ç‚¹ï¼š
  - åªæœ‰å±æ€§ï¼ˆå­—æ®µï¼‰å’Œå¯¹åº”çš„ **getter/setter** æ–¹æ³•ï¼›
  - å¯èƒ½ä¼šæœ‰æ„é€ æ–¹æ³•ã€`toString()`ã€`equals()`ã€`hashCode()`ï¼›
  - **æ²¡æœ‰ä¸šåŠ¡é€»è¾‘**ï¼Œä¸ç»§æ‰¿æ¡†æ¶ç±»ï¼Œä¹Ÿä¸å®ç°å¤æ‚æ¥å£ã€‚

æ¯”å¦‚ä½ æœ‰ä¸€ä¸ª `goods` è¡¨ï¼Œå¯èƒ½ä¼šåœ¨ `pojo` é‡Œæ”¾ä¸€ä¸ª `Goods.java`ã€‚

```java
package com.example.project.pojo;

public class Goods {
    private int id;
    private String fname;
    private double price;
    private int fcont;
    private String remark;

    // getter å’Œ setter
    // toString()
}

```

**å¸¸è§çš„åˆ†å±‚**

```java
src/main/java/com/example/project/
â”œâ”€â”€ controller   ï¼ˆæ§åˆ¶å±‚ï¼Œå¤„ç†è¯·æ±‚ï¼‰
â”œâ”€â”€ service      ï¼ˆä¸šåŠ¡é€»è¾‘å±‚ï¼‰
â”œâ”€â”€ dao          ï¼ˆæ•°æ®è®¿é—®å±‚ï¼‰
â”œâ”€â”€ pojo / entityï¼ˆå®ä½“ç±»/æ•°æ®å¯¹è±¡ï¼‰
```

**ç®€å•é¡¹ç›®ä¸¾ä¾‹**

é¡¹ç›®ç»“æ„

```java
src/main/java/com/example/project/
â”œâ”€â”€ controller
â”‚   â”œâ”€â”€ GoodsListServlet.java
â”‚   â””â”€â”€ GoodsAddServlet.java
â”œâ”€â”€ service
â”‚   â””â”€â”€ GoodsService.java
â”œâ”€â”€ dao
â”‚   â””â”€â”€ GoodsDao.java
â”œâ”€â”€ pojo
â”‚   â””â”€â”€ Goods.java
â””â”€â”€ utils
    â””â”€â”€ DBUtil.java
```

Service å±‚ç¤ºä¾‹

```java
package com.example.project.service;

import com.example.project.dao.GoodsDao;
import com.example.project.pojo.Goods;

import java.util.List;

public class GoodsService {

    private GoodsDao dao = new GoodsDao();

    // è·å–æ‰€æœ‰å•†å“
    public List<Goods> getAllGoods() {
        return dao.getAllGoods();
    }

    // æ·»åŠ å•†å“
    public int addGoods(Goods g) {
        // è¿™é‡Œå¯ä»¥åŠ å…¥ä¸šåŠ¡é€»è¾‘ï¼Œä¾‹å¦‚ï¼š
        if (g.getPrice() < 0) {
            throw new IllegalArgumentException("ä»·æ ¼ä¸èƒ½ä¸ºè´Ÿæ•°");
        }
        if (g.getFcont() < 0) {
            throw new IllegalArgumentException("åº“å­˜ä¸èƒ½ä¸ºè´Ÿæ•°");
        }
        return dao.addGoods(g);
    }
}

```

æ”¹é€  Servlet å±‚

* æŸ¥è¯¢å•†å“åˆ—è¡¨æ¥å£

```java
package com.example.project.controller;

import com.example.project.pojo.Goods;
import com.example.project.service.GoodsService;
import com.google.gson.Gson;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.*;
import java.io.IOException;
import java.io.PrintWriter;
import java.util.List;

@WebServlet("/goods/list")
public class GoodsListServlet extends HttpServlet {

    private GoodsService service = new GoodsService();

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp)
            throws ServletException, IOException {

        List<Goods> list = service.getAllGoods();

        resp.setContentType("application/json;charset=UTF-8");
        PrintWriter out = resp.getWriter();
        String json = new Gson().toJson(list);
        out.print(json);
        out.flush();
    }
}

```

* æ·»åŠ å•†å“æ¥å£

```java
package com.example.project.controller;

import com.example.project.pojo.Goods;
import com.example.project.service.GoodsService;
import com.google.gson.Gson;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.*;
import java.io.BufferedReader;
import java.io.IOException;
import java.io.PrintWriter;

@WebServlet("/goods/add")
public class GoodsAddServlet extends HttpServlet {

    private GoodsService service = new GoodsService();

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp)
            throws ServletException, IOException {

        // è¯»å–è¯·æ±‚ JSON
        StringBuilder sb = new StringBuilder();
        BufferedReader reader = req.getReader();
        String line;
        while ((line = reader.readLine()) != null) {
            sb.append(line);
        }

        Goods g = new Gson().fromJson(sb.toString(), Goods.class);

        int newId = service.addGoods(g);

        resp.setContentType("application/json;charset=UTF-8");
        PrintWriter out = resp.getWriter();
        out.print("{\"newId\":" + newId + "}");
        out.flush();
    }
}

```

ğŸ¨ **æ€»ç»“ï¼š**

* **Controller/Servlet** â†’ åªè´Ÿè´£æ¥æ”¶è¯·æ±‚ã€è¿”å› JSON

* **Service å±‚** â†’ å¤„ç†ä¸šåŠ¡é€»è¾‘ã€æ ¡éªŒæ•°æ®

* **DAO å±‚** â†’ ç›´æ¥æ“ä½œæ•°æ®åº“

* **POJO** â†’ æ•°æ®ä¼ è¾“å¯¹è±¡ï¼ˆGoodsï¼‰
