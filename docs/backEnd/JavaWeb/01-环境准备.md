# 环境准备

## 初始化数据库

创建数据库

```sql
create database javaweb;
```

创建表

```sql
-- ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
-- 存储引擎设置为 InnoDB，支持 事务 (Transaction)，保证数据安全性（如转账操作要么全部成功，要么全部失败）。支持 行级锁，并发性能好。支持 外键约束，表与表之间可以建立外键关系。
-- utf8mb4 是 MySQL 里真正的 完整 UTF-8 实现，支持所有 Unicode 字符

CREATE TABLE goods (
    id INT AUTO_INCREMENT PRIMARY KEY COMMENT '唯一ID',
    fname VARCHAR(100) NOT NULL COMMENT '名字',
    price DECIMAL(10,2) NOT NULL COMMENT '价格',
    fcont INT NOT NULL COMMENT '库存数量',
    remark VARCHAR(255) COMMENT '描述'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

```

插入数据

```sql
INSERT INTO goods (fname, price, fcont, remark) VALUES
('苹果', 3.50, 100, '新鲜的红富士苹果'),
('梨', 2.80, 80, '香甜多汁的雪梨'),
('桃子', 5.20, 60, '水蜜桃，入口即化'),
('香蕉', 4.00, 120, '进口香蕉，口感香甜'),
('橙子', 3.80, 90, '维C丰富的橙子'),
('西瓜', 15.00, 30, '大西瓜，清凉解暑');
```

## 数据库连接池

**druid使用步骤：**

```ts
1 把druid-1.1.10.jar包放在lib文件夹中。
2 然后把这个文件夹作为一个 lib文件夹。
3 手动导入lib到项目中。
3 如果项目中要用，点击项目的名称然后 project Struture页面，选择Modules，在Dependencies选项卡中，点击右侧的加号，选择导入的libraries
```

## 项目分层

在 Java 项目里经常看到一个叫 **`pojo`** 的文件夹，它不是 Java 官方规定的，而是大家约定俗成的一种目录名。

**pojo的含义**

- **POJO** = **Plain Old Java Object**，翻译为“简单的 Java 对象”。
- 特点：
  - 只有属性（字段）和对应的 **getter/setter** 方法；
  - 可能会有构造方法、`toString()`、`equals()`、`hashCode()`；
  - **没有业务逻辑**，不继承框架类，也不实现复杂接口。

比如你有一个 `goods` 表，可能会在 `pojo` 里放一个 `Goods.java`。

```java
package com.example.project.pojo;

public class Goods {
    private int id;
    private String fname;
    private double price;
    private int fcont;
    private String remark;

    // getter 和 setter
    // toString()
}

```

**常见的分层**

```java
src/main/java/com/example/project/
├── controller   （控制层，处理请求）
├── service      （业务逻辑层）
├── dao          （数据访问层）
├── pojo / entity（实体类/数据对象）
```

**简单项目举例**

项目结构

```java
src/main/java/com/example/project/
├── controller
│   ├── GoodsListServlet.java
│   └── GoodsAddServlet.java
├── service
│   └── GoodsService.java
├── dao
│   └── GoodsDao.java
├── pojo
│   └── Goods.java
└── utils
    └── DBUtil.java
```

Service 层示例

```java
package com.example.project.service;

import com.example.project.dao.GoodsDao;
import com.example.project.pojo.Goods;

import java.util.List;

public class GoodsService {

    private GoodsDao dao = new GoodsDao();

    // 获取所有商品
    public List<Goods> getAllGoods() {
        return dao.getAllGoods();
    }

    // 添加商品
    public int addGoods(Goods g) {
        // 这里可以加入业务逻辑，例如：
        if (g.getPrice() < 0) {
            throw new IllegalArgumentException("价格不能为负数");
        }
        if (g.getFcont() < 0) {
            throw new IllegalArgumentException("库存不能为负数");
        }
        return dao.addGoods(g);
    }
}

```

改造 Servlet 层

* 查询商品列表接口

```java
package com.example.project.controller;

import com.example.project.pojo.Goods;
import com.example.project.service.GoodsService;
import com.google.gson.Gson;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.*;
import java.io.IOException;
import java.io.PrintWriter;
import java.util.List;

@WebServlet("/goods/list")
public class GoodsListServlet extends HttpServlet {

    private GoodsService service = new GoodsService();

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp)
            throws ServletException, IOException {

        List<Goods> list = service.getAllGoods();

        resp.setContentType("application/json;charset=UTF-8");
        PrintWriter out = resp.getWriter();
        String json = new Gson().toJson(list);
        out.print(json);
        out.flush();
    }
}

```

* 添加商品接口

```java
package com.example.project.controller;

import com.example.project.pojo.Goods;
import com.example.project.service.GoodsService;
import com.google.gson.Gson;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.*;
import java.io.BufferedReader;
import java.io.IOException;
import java.io.PrintWriter;

@WebServlet("/goods/add")
public class GoodsAddServlet extends HttpServlet {

    private GoodsService service = new GoodsService();

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp)
            throws ServletException, IOException {

        // 读取请求 JSON
        StringBuilder sb = new StringBuilder();
        BufferedReader reader = req.getReader();
        String line;
        while ((line = reader.readLine()) != null) {
            sb.append(line);
        }

        Goods g = new Gson().fromJson(sb.toString(), Goods.class);

        int newId = service.addGoods(g);

        resp.setContentType("application/json;charset=UTF-8");
        PrintWriter out = resp.getWriter();
        out.print("{\"newId\":" + newId + "}");
        out.flush();
    }
}

```

🎨 **总结：**

* **Controller/Servlet** → 只负责接收请求、返回 JSON

* **Service 层** → 处理业务逻辑、校验数据

* **DAO 层** → 直接操作数据库

* **POJO** → 数据传输对象（Goods）
