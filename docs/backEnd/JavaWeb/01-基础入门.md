# JavaWeb

## JDBCæ¡ˆä¾‹

### åˆå§‹åŒ–æ•°æ®åº“

åˆ›å»ºæ•°æ®åº“

```sql
create database javaweb;
```

åˆ›å»ºè¡¨

```sql
-- ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
-- å­˜å‚¨å¼•æ“è®¾ç½®ä¸º InnoDBï¼Œæ”¯æŒ äº‹åŠ¡ (Transaction)ï¼Œä¿è¯æ•°æ®å®‰å…¨æ€§ï¼ˆå¦‚è½¬è´¦æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼‰ã€‚æ”¯æŒ è¡Œçº§é”ï¼Œå¹¶å‘æ€§èƒ½å¥½ã€‚æ”¯æŒ å¤–é”®çº¦æŸï¼Œè¡¨ä¸è¡¨ä¹‹é—´å¯ä»¥å»ºç«‹å¤–é”®å…³ç³»ã€‚
-- utf8mb4 æ˜¯ MySQL é‡ŒçœŸæ­£çš„ å®Œæ•´ UTF-8 å®ç°ï¼Œæ”¯æŒæ‰€æœ‰ Unicode å­—ç¬¦

CREATE TABLE goods (
    id INT AUTO_INCREMENT PRIMARY KEY COMMENT 'å”¯ä¸€ID',
    fname VARCHAR(100) NOT NULL COMMENT 'åå­—',
    price DECIMAL(10,2) NOT NULL COMMENT 'ä»·æ ¼',
    fcount INT NOT NULL COMMENT 'åº“å­˜æ•°é‡',
    remark VARCHAR(255) COMMENT 'æè¿°'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

```

æ’å…¥æ•°æ®

```sql
INSERT INTO goods (fname, price, fcont, remark) VALUES
('è‹¹æœ', 3.50, 100, 'æ–°é²œçš„çº¢å¯Œå£«è‹¹æœ'),
('æ¢¨', 2.80, 80, 'é¦™ç”œå¤šæ±çš„é›ªæ¢¨'),
('æ¡ƒå­', 5.20, 60, 'æ°´èœœæ¡ƒï¼Œå…¥å£å³åŒ–'),
('é¦™è•‰', 4.00, 120, 'è¿›å£é¦™è•‰ï¼Œå£æ„Ÿé¦™ç”œ'),
('æ©™å­', 3.80, 90, 'ç»´Cä¸°å¯Œçš„æ©™å­'),
('è¥¿ç“œ', 15.00, 30, 'å¤§è¥¿ç“œï¼Œæ¸…å‡‰è§£æš‘');
```

### æ•°æ®åº“è¿æ¥æ± 

**druidä½¿ç”¨æ­¥éª¤ï¼š**

æ–¹å¼1ï¼šæ‰‹åŠ¨å¯¼jaråŒ…

```ts
1 æŠŠdruid-1.1.10.jaråŒ…æ”¾åœ¨libsæ–‡ä»¶å¤¹ä¸­
2 é€‰ä¸­libsæ–‡ä»¶å¤¹ å³é”® add as library
3 é€‰æ‹©è¦ä½¿ç”¨çš„èŒƒå›´
4 è¿™æ ·å°±å¯ä»¥ä¸‹æ‹‰æŸ¥çœ‹é‡Œè¾¹çš„classæ–‡ä»¶äº†
```

æ–¹å¼2ï¼šä½¿ç”¨mavenç®¡ç†ï¼Œåœ¨pom.xmlä¸Šæ·»åŠ 

```xml
ä»¥åå†ä½¿ç”¨
```

æ–°å»ºjdbc.propertiesï¼Œä½äº` src/jdbc.properties`

```java
driverClassName=com.mysql.cj.jdbc.Driver
url=jdbc:mysql://localhost:3306/yourdb?useSSL=false&serverTimezone=UTC&characterEncoding=utf8
username=root
password=123456

# è¿æ¥æ± å‚æ•°
initialSize=5
maxActive=20
minIdle=5
maxWait=60000

```

ä¿®æ”¹ `DBUtil.java`ï¼Œä½¿ç”¨ Druidï¼Œä½äº src/com.fruit.utils.DButil.java

```java
package com.example.project.utils;

import com.alibaba.druid.pool.DruidDataSourceFactory;

import javax.sql.DataSource;
import java.io.InputStream;
import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.Statement;
import java.util.Properties;

public class DBUtil {

    private static DataSource dataSource;

    // åˆå§‹åŒ–è¿æ¥æ± 
    static {
        try {
            Properties prop = new Properties();
            InputStream in = DBUtil.class.getClassLoader().getResourceAsStream("jdbc.properties");
            prop.load(in);
            dataSource = DruidDataSourceFactory.createDataSource(prop);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    // è·å–è¿æ¥
    public static Connection getConnection() throws Exception {
        return dataSource.getConnection();
    }

    // å…³é—­èµ„æº
    public static void close(Connection conn, Statement stmt, ResultSet rs) {
        try {
            if (rs != null) rs.close();
            if (stmt != null) stmt.close();
            if (conn != null) conn.close(); // å½’è¿˜è¿æ¥åˆ°è¿æ¥æ± 
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}

```

æµ‹è¯•ç±»

```java
package com.example.project.test;

import com.example.project.utils.DBUtil;

import java.sql.Connection;

public class TestDB {
    public static void main(String[] args) throws Exception {
        Connection conn = DBUtil.getConnection();
        System.out.println("è·å–è¿æ¥æˆåŠŸ: " + conn);
        conn.close(); // å½’è¿˜åˆ°æ± 
    }
}

```

### åˆ›å»ºJDBC

åœ¨æ ¹ç›®å½•åˆ›å»ºlibsæ–‡ä»¶å¤¹ï¼Œå¯¼å…¥ druid å’Œ mysql é©±åŠ¨åŒ…ã€‚æŠŠlibsä½œä¸º Add as Library

åˆ›å»ºdaoç›®å½•ï¼ˆsrc/daoï¼‰ï¼Œpojoç›®å½•(src/pojo)ï¼Œutilsç›®å½•(src/utils)ï¼Œtestç›®å½•(test/)ã€‚

åˆ›å»º æ•°æ®åº“é…ç½®æ–‡ä»¶ jdbc.properties (src/jdbc.properties)ã€‚

å°è£…mysqlæ•°æ®åº“ä¸­è¡¨çš„å®ä½“ç±»ï¼šsrc/pojo/Fruit.java

```java
package com.fruit.pojo;

import java.math.BigDecimal;

public class Fruit {
    // ç§æœ‰å±æ€§
    private Integer id;
    private String fname;
    private BigDecimal price; // ç”¨ BigDecimal å­˜é‡‘é¢
    private Integer fcount;
    private String remark;

    public Fruit() {
    }

    public Fruit(Integer id, String fname, BigDecimal price, Integer fcount, String remark) {
        this.id = id;
        this.fname = fname;
        this.price = price;
        this.fcount = fcount;
        this.remark = remark;
    }

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getFname() {
        return fname;
    }

    public void setFname(String fname) {
        this.fname = fname;
    }

    public BigDecimal getPrice() {
        return price;
    }

    public void setPrice(BigDecimal price) {
        this.price = price;
    }

    public Integer getFcount() {
        return fcount;
    }

    public void setFcount(Integer fcount) {
        this.fcount = fcount;
    }

    public String getRemark() {
        return remark;
    }

    public void setRemark(String remark) {
        this.remark = remark;
    }

    @Override
    public String toString() {
        return "Fruit{" +
                "id=" + id +
                ", fname='" + fname + '\'' +
                ", price=" + price +
                ", fcount=" + fcount +
                ", remark='" + remark + '\'' +
                '}';
    }
}

```

å°è£…æ•°æ®åº“è¿æ¥æ± å·¥å…·ç±»ï¼šsrc/utils/DButil.java

```java
package com.fruit.utils;

import com.alibaba.druid.pool.DruidDataSource;
import com.alibaba.druid.pool.DruidPooledConnection;

import java.io.InputStream;
import java.sql.*;
import java.util.Properties;

public class DButil {
    // å®šä¹‰é™æ€æ•°æ®
    private static String DRIVER;
    private static String URL;
    private static String USER;
    private static String PWD;
    // å®šä¹‰é™æ€çš„ æ•°æ®åº“è¿æ¥æ± å¯¹è±¡
    private static DruidDataSource dataSource;

    // é™æ€ä»£ç å—ï¼Œåœ¨ç±»åŠ è½½æ—¶è¯»å–é…ç½®
    static {
        try {
            // åˆ›å»ºProperties Mapé›†åˆç±»
            Properties prop = new Properties();
            // è·å–å½“å‰ç±»åŠ è½½å™¨ï¼Œè·å– jdbcçš„è¯»å–æµ
            InputStream in = DButil.class.getClassLoader().getResourceAsStream("jdbc.properties");
            // åŠ è½½é…ç½®æ–‡ä»¶
            prop.load(in);

            // è·å–æ•°æ®åº“è¿æ¥æ± å¯¹è±¡(æ–¹å¼1)
            // æ–¹å¼ 1ï¼šDruidDataSourceFactory.createDataSource(prop)
            // ç›´æ¥ç”¨ å·¥å‚æ–¹æ³• æ ¹æ® Properties é…ç½®ç”Ÿæˆä¸€ä¸ª DruidDataSource å¯¹è±¡
            // é…ç½®é›†ä¸­åœ¨ jdbc.properties æ–‡ä»¶é‡Œï¼Œæ”¯æŒ Druid çš„å„ç§é«˜çº§é…ç½®
            // dataSource = DruidDataSourceFactory.createDataSource(prop);

            // åˆ›å»ºæ•°æ®åº“è¿æ¥æ± å¯¹è±¡(æ–¹å¼2)
            // æ‰‹åŠ¨åˆ›å»º Druid è¿æ¥æ± å¯¹è±¡ï¼Œç„¶åé€ä¸ªè®¾ç½®å±æ€§
            dataSource = new DruidDataSource();

            // è·å–propertiesæ–‡ä»¶ä¸­çš„å€¼
            DRIVER = prop.getProperty("DRIVER");
            URL = prop.getProperty("URL");
            USER = prop.getProperty("USER");
            PWD = prop.getProperty("PWD");

            // åŠ è½½mysqlé©±åŠ¨(æ•°æ®åº“è¿æ¥æ±  Druidä¼šè‡ªåŠ¨åŠ è½½mysqlé©±åŠ¨)
            // Class.forName(DRIVER);

            // è®¾ç½®ç”¨æˆ·åï¼Œå¯†ç 
            dataSource.setDriverClassName(DRIVER);
            dataSource.setUrl(URL);
            dataSource.setUsername(USER);
            dataSource.setPassword(PWD);

        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    // è·å–è¿æ¥,è¿”å›ä¸€ä¸ªè¿æ¥å¯¹è±¡
    public static Connection getConnection() {
        try {
           return dataSource.getConnection();
        } catch (SQLException e) {
            e.printStackTrace();
        }
        return null;
    }

    // å…³é—­è¿æ¥
    public static void close(Connection conn, Statement stmt, ResultSet rs) {
        try {
            if (rs != null) rs.close();
            if (stmt != null) stmt.close();
            if (conn != null) conn.close();
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}
```

å°è£…åå°„çš„å·¥å…·ç±» ClassUtil.java (src/utils/ClassUtil)

```java
package com.fruit.utils;

import java.lang.reflect.Field;

public class ClassUtil {
    // è·å– Classå¯¹è±¡
    public static Class getEntityClass(String entityName){
        try {
            return Class.forName(entityName);
        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        }
        return null;
    }
    // é€šè¿‡åå°„åˆ›å»ºClasså¯¹è±¡çš„å®ä¾‹
    public static Object createInstance(String entityName){
        try {
            return getEntityClass(entityName).newInstance();
        } catch (InstantiationException e) {
            e.printStackTrace();
        } catch (IllegalAccessException e) {
            e.printStackTrace();
        }
        return null;
    }

    // é€šè¿‡åå°„ç»™å®ä¾‹çš„å±æ€§èµ‹å€¼
    public static void setProperty(Object obj,String propertyName,Object propertyValue){
        try {
            Field field = obj.getClass().getDeclaredField(propertyName);
            // å¿½ç•¥è­¦å‘Š
            field.setAccessible(true);
            // èµ‹å€¼
            field.set(obj,propertyValue);
        } catch (NoSuchFieldException e) {
            e.printStackTrace();
        } catch (IllegalAccessException e) {
            e.printStackTrace();
        }
    }
}

```

å°è£…é€šç”¨ BaseDao (src/dao/BaseDao.java)

```java
package com.fruit.dao;

import com.fruit.utils.ClassUtil;
import com.fruit.utils.DButil;

import java.lang.reflect.ParameterizedType;
import java.lang.reflect.Type;
import java.sql.*;
import java.util.ArrayList;
import java.util.List;

// å®šä¹‰BaseDaoä¸ºä¸€ä¸ªæŠ½è±¡ç±»
public abstract class BaseDao<T> {
    // å®šä¹‰æ³›å‹çš„åç§°
    private String entityClassName;
    // å®šä¹‰ResultSetç»“æœé›†
    private ResultSet rs;
    // è¿æ¥æ± å¯¹è±¡
    Connection connection = null;
    // sqlè¯­å¥å¯¹è±¡
    PreparedStatement pstm = null;

    // åœ¨æ— å‚æ„é€ ä¸­ï¼Œè·å–æ³›å‹ç±»å‹ï¼Œå­ç±»è°ƒç”¨æ„é€ ï¼Œé»˜è®¤è°ƒç”¨çˆ¶ç±»çš„æ— å‚æ„é€ 
    public BaseDao(){
        // è°ƒç”¨
        getEntityClassName();

    }
    // è·å–å­ç±»å®ä¾‹ç»™çˆ¶ç±»æ³›å‹Tä¼ å…¥çš„åç§°
    private void getEntityClassName(){
        // é€šè¿‡å­ç±»å®ä¾‹å¯¹è±¡ï¼Œè·å–çˆ¶ç±»ï¼ˆè‡ªå·±ï¼‰çš„æ³›å‹Tçš„å®é™…åç§°
        // æ­¤å¤„çš„thisä»£è¡¨çš„æ˜¯FruitDaoImplå®ä¾‹ï¼Œè€Œä¸æ˜¯BaseDao
        // this.getClass()å¾—åˆ°çš„å°±æ˜¯FruitDaoImplçš„Classå¯¹è±¡
        // getGenericSuperclass() è·å–å¸¦æœ‰æ³›å‹çš„çˆ¶ç±»,å› æ­¤å¯ä»¥è·å–åˆ° BaseDao<Fruit>
        // å› ä¸ºæˆ‘ä»¬æ˜¯è¿™æ ·å®šä¹‰çš„ï¼šclass FruitDaoImpl extends BaseDao<Fruit>ï¼Œæ‰€ä»¥æ³›å‹çˆ¶ç±»æ˜¯ï¼š BaseDao<Fruit>
        Type genericSuperclass = this.getClass().getGenericSuperclass();
        // æŠŠçˆ¶ç±»çš„æ³›å‹ä¿¡æ¯ï¼Œä»é€šç”¨çš„ Type å¼ºè½¬ä¸º ParameterizedTypeï¼Œä»¥ä¾¿åç»­è·å–å®é™…çš„æ³›å‹å‚æ•°ã€‚
        // å¼ºè½¬ä¸ºParameterizedTypeç±»å‹
        ParameterizedType parameterizedType = (ParameterizedType) genericSuperclass;
        // getActualTypeArguments è·å–å®é™…çš„ç±»å‹å‚æ•°
        Type[] actualTypeArguments = parameterizedType.getActualTypeArguments();
        // å› ä¸ºå½“å‰BaseDao<T>åé¢åªæœ‰ä¸€ä¸ªæ³›å‹ä½ç½®ï¼Œæ‰€ä»¥æ­¤å¤„æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯[0]
        // getTypeName() è·å–ç±»å‹åç§°
        // getTypeName() è¿”å›å®Œæ•´ç±»åï¼Œä¾‹å¦‚ "com.xxx.pojo.Fruit"
        String typeName = actualTypeArguments[0].getTypeName();
        entityClassName = typeName;
    }

    // å®šä¹‰è®¾ç½®å‚æ•°çš„æ–¹æ³•
    private void setParams(PreparedStatement psmt , Object... params) throws SQLException {
        if(params!=null && params.length>0){
            for (int i = 0; i < params.length; i++) {
                psmt.setObject(i+1,params[i]);
            }
        }
    }

    // æ‰§è¡Œå¢åˆ æ”¹çš„æ“ä½œ
    protected int executeUpdate(String sql,Object ...params){
        // å»é™¤ç©ºæ ¼ï¼Œå¹¶è½¬ä¸ºå°å†™
        sql = sql.trim().toUpperCase();
        // è®¾ç½®æ ‡è®°æ˜¯å¦æ˜¯æ’å…¥è¯­å¥
        boolean insertFlag = sql.startsWith("INSERT INTO");
        // è·å–è¿æ¥å¯¹è±¡
        connection = DButil.getConnection();

        try {
            // åˆ¤æ–­æ˜¯å¦æ˜¯æ’å…¥è¯­å¥
            if (insertFlag){
                // è·å–sqlæ‰§è¡Œè¯­å¥å¯¹è±¡,æ’å…¥è¯­å¥
                pstm = connection.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);
            }else{ // éæ’å…¥è¯­å¥
                pstm = connection.prepareStatement(sql);
            }
            // ç»™sqlè¯­å¥ä¼ å…¥å‚æ•°
            setParams(pstm,params);
            // æ‰§è¡Œsql
            int resRow = pstm.executeUpdate();
            // è¿”å›
            if(insertFlag) { // å¦‚æœæ˜¯æ’å…¥è¯­å¥
                // è·å–è‡ªå¢id
                rs = pstm.getGeneratedKeys();
                // å¦‚æœè¿”å›æœ‰å€¼
                if(rs.next()){
                    // è·å–ç¬¬ä¸€åˆ—æ•°æ®
                    return (rs.getInt(1));
                }
            }else{
                return resRow; // è¿”å›é»˜è®¤å—å½±å“è¡Œæ•°
            }
        } catch (SQLException e) {
            e.printStackTrace();
        } finally {
            // å…³é—­è¿æ¥
            DButil.close(connection,pstm,rs);
        }
        return 0;
    }

    // æŸ¥è¯¢çš„æ–¹æ³•
    protected List<T> executeQuery(String sql,Object ...params){
        List<T> list = new ArrayList<>();
        connection = DButil.getConnection();
        try {
            // è·å–statementå¯¹è±¡
             pstm = connection.prepareStatement(sql);
             // è®¾ç½®SQLå‚æ•°
            setParams(pstm,params);
            // æ‰§è¡ŒSQL
            rs = pstm.executeQuery();
            // æ–¹å¼1ï¼šé€šè¿‡åå°„æ¥å¤„ç†
            // æ–¹å¼2ï¼šé€šè¿‡æ•°æ®è§£æå™¨æ¥å¤„ç†ï¼ˆè§JDBCç« èŠ‚ï¼‰
            // è·å–ç»“æœé›†çš„å…ƒæ•°æ®ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€è¡Œçš„æ•°æ®
            ResultSetMetaData metaData = rs.getMetaData();
            // è·å–å…ƒæ•°æ®çš„åˆ—æ•°
            int columnCount = metaData.getColumnCount();
            // éå†ç»“æœé›†
            while(rs.next()){
                // é€šè¿‡åå°„è·å–å®ä½“ç±»çš„Classå¯¹è±¡
                Class entityClass = ClassUtil.getEntityClass(entityClassName);
                // é€šè¿‡åå°„åˆ›å»ºå®ä¾‹,å¼ºè½¬ä¸ºTç±»å‹
                T instance = (T)ClassUtil.createInstance(entityClassName);
                // éå†
                for (int i = 0; i < columnCount; i++) {
                    // è¯»å–åˆ—å
                    String columnName = metaData.getColumnName(i + 1);
                    // è·å–å½“å‰è¡ŒæŒ‡å®šåˆ—çš„å€¼
                    Object columnValue = rs.getObject(i + 1);
                    // ç»™å®ä¾‹èµ‹å€¼
                    ClassUtil.setProperty(instance,columnName,columnValue);
                }
                // é›†åˆä¸­æ·»åŠ å…ƒç´ 
                list.add(instance);
            }
        } catch (Exception e) {
            e.printStackTrace();
        }finally {
            DButil.close(connection,pstm,rs);
        }
        return list;
    }
}

```

å®šä¹‰å…·ä½“ç±»çš„DAOæ¥å£ï¼šsrc/dao/FruitDao.java

```java
package com.fruit.dao;

import com.fruit.pojo.Fruit;

import java.util.List;

public interface FruitDao {
    // è·å–æ‰€æœ‰çš„åº“å­˜è®°å½•
    List<Fruit> getFruitList();

    // æ·»åŠ æ–°åº“å­˜
    void addFruit(Fruit fruit);

    // åˆ é™¤æŒ‡å®šçš„åº“å­˜è®°å½•
    void delFruit(Integer id);

    // è·å–æŒ‡å®šçš„åº“å­˜è®°å½•
    Fruit getFruit(Integer id);
    Fruit getFruit(String name);

    // ä¿®æ”¹åº“å­˜è®°å½•
    void updateFruit(Fruit fruit);
}

```

å®šä¹‰å®ä½“ç±»DAOæ¥å£çš„å®ç°ç±» src/dao/impl/FruitDaoImpl.java

```java
package com.fruit.dao.impl;

import com.fruit.dao.BaseDao;
import com.fruit.dao.FruitDao;
import com.fruit.pojo.Fruit;

import java.util.List;

public class FruitDaoImpl extends BaseDao<Fruit> implements FruitDao {
    @Override
    public List<Fruit> getFruitList() {
        String sql = "select * from goods";
        List<Fruit> fruits = this.executeQuery(sql, null);
        return fruits;
    }

    @Override
    public void addFruit(Fruit fruit) {
        String sql = "insert into goods values(0,?,?,?,?)";
        int resRow = this.executeUpdate(sql, fruit.getFname(), fruit.getPrice(), fruit.getFcount(), fruit.getRemark());
        // æ‰“å°å—å½±å“è¡Œæ•°
        System.out.println("resRow = " + resRow);
    }

    @Override
    public void delFruit(Integer id) {

    }

    @Override
    public Fruit getFruit(Integer id) {
        return null;
    }

    @Override
    public Fruit getFruit(String name) {
        return null;
    }

    @Override
    public void updateFruit(Fruit fruit) {

    }
}

```

å®šä¹‰ JDBCé…ç½®æ–‡ä»¶ï¼šsrc/jdbc.properties

```properties
DRIVER=com.mysql.cj.jdbc.Driver
URL=jdbc:mysql://192.168.1.38:3306/javaweb?useSSL=false&serverTimezone=UTC&characterEncoding=utf8
USER=hanser
PWD=234234
```

æµ‹è¯•ç±»ï¼štest/TestFruit.java

```java
import com.fruit.dao.FruitDao;
import com.fruit.dao.impl.FruitDaoImpl;
import com.fruit.pojo.Fruit;
import org.junit.Test;

import java.math.BigDecimal;
import java.util.List;

public class TestFruit {
    // åˆ›å»ºfruitDaoå®ä¾‹
    private FruitDao fruitDao = new FruitDaoImpl();

    @Test
    public void test01 (){
        BigDecimal bigDecimal = new BigDecimal("6.00");
        Fruit fruit = new Fruit(10,"é»„æ¡ƒ",bigDecimal,60,"é»„æ¡ƒå¾ˆå¥½åƒ");
        fruitDao.addFruit(fruit);
    }

    @Test
    public void test02 (){
        List<Fruit> fruitList = fruitDao.getFruitList();
        for (Fruit fruit : fruitList) {
            System.out.println("fruit = " + fruit);
        }
    }
}
```

## ç›¸å…³APIæ¥å£

### DataSourceæ¥å£

`DataSource` æ˜¯ **JDBC è§„èŒƒæ¥å£**ï¼Œå®ƒæ˜¯ `DriverManager` çš„æ›¿ä»£æ–¹æ¡ˆï¼Œç”¨äºè·å–æ•°æ®åº“è¿æ¥ã€‚

```java
// ç®€å•ç†è§£ï¼šDataSource æä¾›æ•°æ®åº“è¿æ¥
DataSource ds = ...;
Connection conn = ds.getConnection();
```

æ–¹æ³•

getConnection()

```java
ä½œç”¨ï¼šè·å–æ•°æ®åº“è¿æ¥
    
å‚æ•°ï¼šæ— 
    
è¿”å›å€¼ï¼šConnectionå¯¹è±¡
    
ç¤ºä¾‹ï¼š
    
Connection getConnection() throws SQLException; // è·å–æ•°æ®åº“è¿æ¥
```

```java
public interface DataSource {
    Connection getConnection() throws SQLException; // è·å–æ•°æ®åº“è¿æ¥
    Connection getConnection(String username, String password) throws SQLException; // æŒ‡å®šç”¨æˆ·åå¯†ç 
    PrintWriter getLogWriter() throws SQLException; // è·å–æ—¥å¿—è¾“å‡º
    void setLogWriter(PrintWriter out) throws SQLException; // è®¾ç½®æ—¥å¿—è¾“å‡º
    void setLoginTimeout(int seconds) throws SQLException; // è®¾ç½®è¶…æ—¶æ—¶é—´
    int getLoginTimeout() throws SQLException; // è·å–è¶…æ—¶æ—¶é—´
    java.util.logging.Logger getParentLogger() throws SQLFeatureNotSupportedException; // æ—¥å¿—
}
```

### DruidDataSourceæ¥å£

æ„é€ æ–¹æ³•

```java
// æ— å‚æ„é€ 
public DruidDataSource()

// æœ‰å‚æ„é€ ï¼ˆå¸¸è§å†™æ³•æ˜¯å…ˆ new å† setï¼Œä¸å¤ªç”¨åˆ°æœ‰å‚æ„é€ ï¼‰
public DruidDataSource(boolean lockFair) 
// lockFair: å…¬å¹³é”æ ‡å¿—ï¼Œä¸€èˆ¬é»˜è®¤ false å³å¯
    

```

æ–¹æ³•

```java
ä½œç”¨ï¼š
    
å‚æ•°ï¼š
    
è¿”å›å€¼ï¼š
    
ç¤ºä¾‹ï¼š
```

```ts
// åŸºç¡€é…ç½®
setDriverClassName(String driverClassName)   // è®¾ç½® JDBC é©±åŠ¨ç±»
setUrl(String url)                           // è®¾ç½®æ•°æ®åº“è¿æ¥ URL
setUsername(String username)                 // è®¾ç½®æ•°æ®åº“ç”¨æˆ·å
setPassword(String password)                 // è®¾ç½®æ•°æ®åº“å¯†ç 

// è¿æ¥æ± ç®¡ç†
setInitialSize(int size)     // è®¾ç½®åˆå§‹åŒ–æ—¶åˆ›å»ºçš„è¿æ¥æ•°
setMaxActive(int maxActive)  // è®¾ç½®æœ€å¤§è¿æ¥æ•°
setMinIdle(int minIdle)      // è®¾ç½®æœ€å°ç©ºé—²è¿æ¥æ•°
setMaxWait(long millis)      // è·å–è¿æ¥æ—¶æœ€å¤§ç­‰å¾…æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰

// è¶…æ—¶ä¸æ£€æµ‹
setValidationQuery(String sql)   // ç”¨æ¥æ£€æµ‹è¿æ¥æ˜¯å¦æœ‰æ•ˆçš„ SQLï¼Œå¦‚ "SELECT 1"
setTestOnBorrow(boolean flag)    // ä»è¿æ¥æ± å–è¿æ¥æ—¶ï¼Œæ˜¯å¦æ£€æµ‹æœ‰æ•ˆæ€§
setTestOnReturn(boolean flag)    // è¿˜å›è¿æ¥æ—¶ï¼Œæ˜¯å¦æ£€æµ‹æœ‰æ•ˆæ€§
setTestWhileIdle(boolean flag)   // ç©ºé—²æ—¶æ˜¯å¦æ£€æµ‹æœ‰æ•ˆæ€§
setTimeBetweenEvictionRunsMillis(long millis) // æ£€æµ‹çº¿ç¨‹è¿è¡Œé—´éš”
setMinEvictableIdleTimeMillis(long millis)    // è¿æ¥ä¿æŒç©ºé—²è€Œä¸è¢«é©±é€çš„æœ€å°æ—¶é—´

// è·å–è¿æ¥
Connection getConnection()  
Connection getConnection(String username, String password)  

// å…³é—­
close()    // å…³é—­æ•°æ®æºï¼Œé‡Šæ”¾èµ„æº
```



### DruidDataSourceFactoryå·¥å‚ç±»

**`DruidDataSourceFactory`** å¹¶ä¸æ˜¯æ¥å£ï¼Œè€Œæ˜¯é˜¿é‡Œ Druid æä¾›çš„ä¸€ä¸ª **å·¥å‚ç±»**ï¼Œç”¨äºé€šè¿‡é…ç½®ï¼ˆ`Properties`ï¼‰å¿«é€Ÿåˆ›å»º `DruidDataSource` å¯¹è±¡ã€‚

æ„é€ æ–¹æ³•

```ts
// ç§æœ‰æ„é€ ï¼ˆå·¥å…·ç±»ï¼Œä¸å…è®¸å®ä¾‹åŒ–ï¼‰
private DruidDataSourceFactory()
// æ‰€ä»¥ä½ ä¸èƒ½ new DruidDataSourceFactory()ï¼Œåªèƒ½ç›´æ¥è°ƒç”¨å®ƒçš„ é™æ€æ–¹æ³•
	
```

å¸¸ç”¨æ–¹æ³•

createDataSource(Properties properties)

```java
ä½œç”¨ï¼š
    æ ¹æ®ä¼ å…¥çš„é…ç½®ï¼ˆProperties å¯¹è±¡ï¼‰ï¼Œåˆ›å»ºå¹¶è¿”å›ä¸€ä¸ª DruidDataSource æ•°æ®æºã€‚

å‚æ•°ï¼š
    properties â€”â€” æ•°æ®æºé…ç½®ä¿¡æ¯ï¼Œå¸¸è§ key åŒ…æ‹¬ï¼š
        driverClassName   æ•°æ®åº“é©±åŠ¨ç±»
        url               æ•°æ®åº“è¿æ¥åœ°å€
        username          ç”¨æˆ·å
        password          å¯†ç 
        initialSize       åˆå§‹åŒ–è¿æ¥æ•°
        maxActive         æœ€å¤§è¿æ¥æ•°
        minIdle           æœ€å°ç©ºé—²è¿æ¥æ•°
        maxWait           æœ€å¤§ç­‰å¾…æ—¶é—´
        validationQuery   ç”¨äºæ£€æµ‹è¿æ¥æ˜¯å¦å¯ç”¨çš„ SQL

è¿”å›å€¼ï¼š
    DataSource â€”â€” è¿”å›ä¸€ä¸ªé…ç½®å¥½çš„ DruidDataSource å¯¹è±¡

ç¤ºä¾‹ï¼š
Properties props = new Properties();
props.setProperty("driverClassName", "com.mysql.cj.jdbc.Driver");
props.setProperty("url", "jdbc:mysql://localhost:3306/test");
props.setProperty("username", "root");
props.setProperty("password", "123456");

DataSource ds = DruidDataSourceFactory.createDataSource(props);
Connection conn = ds.getConnection();
System.out.println("è¿æ¥æˆåŠŸï¼š" + conn);
conn.close();
```

### Java DOM è§£ææ ¸å¿ƒç±»

ä»¥ä¸‹éƒ½æ˜¯ éƒ½æ˜¯ **Java æ ‡å‡†åº“ JAXP (Java API for XML Processing)** ä¸­ **DOM è§£æ** çš„æ ¸å¿ƒç±»ã€‚

ğŸ”– **DocumentBuilderFactoryå·¥å‚ç±»**

- **åŒ…å**ï¼š`javax.xml.parsers`
- **ä½œç”¨**ï¼šå·¥å‚æ¨¡å¼ç±»ï¼Œç”¨æ¥åˆ›å»º `DocumentBuilder` å®ä¾‹ã€‚
- **ç‰¹ç‚¹**ï¼š

```ts
å•ä¾‹å·¥å‚ï¼Œä¸ç›´æ¥ newã€‚å¯ä»¥é…ç½®ä¸€äº›è§£æç‰¹æ€§ï¼Œæ¯”å¦‚æ˜¯å¦æ ¡éªŒ DTDã€æ˜¯å¦å¿½ç•¥ç©ºç™½èŠ‚ç‚¹ã€‚
```

- **ä½¿ç”¨ç¤ºä¾‹**ï¼š

```java
// åˆ›å»ºfactoryå·¥å‚ç±»å®ä¾‹
DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
// å¿½ç•¥ç©ºç™½
factory.setIgnoringElementContentWhitespace(true); 
// åˆ›å»ºDocumentBuilderå®ä¾‹
DocumentBuilder builder = factory.newDocumentBuilder();
```

ğŸ”– **DocumentBuilderæ¥å£**

- **åŒ…å**ï¼š`javax.xml.parsers`
- **ä½œç”¨**ï¼šè§£æ XML æ–‡ä»¶å¹¶ç”Ÿæˆ **DOM æ ‘**ï¼ˆå³ `Document` å¯¹è±¡ï¼‰ã€‚
- **ç‰¹ç‚¹**ï¼šä¸èƒ½ç›´æ¥ newï¼Œåªèƒ½é€šè¿‡ `DocumentBuilderFactory` è·å–ã€‚

- **æ–¹æ³•**

parse()

```ts
ä½œç”¨ï¼šæŠŠ XML æ–‡ä»¶è½¬æ¢æˆå†…å­˜ä¸­çš„ DOM å¯¹è±¡ã€‚

å‚æ•°ï¼šInputStreamè¾“å…¥æµå¯¹è±¡

è¿”å›å€¼ï¼šdomå¯¹è±¡

ç¤ºä¾‹ï¼š
// è·å–xmlæ–‡ä»¶çš„è¾“å…¥æµå¯¹è±¡
InputStream in = TestXml.class.getClassLoader().getResourceAsStream("students.xml");
// åˆ›å»ºdomå·¥å‚å¯¹è±¡
DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
// åˆ›å»ºdocumentBuilderå¯¹è±¡
DocumentBuilder builder = factory.newDocumentBuilder();
// åˆ›å»ºdomå¯¹è±¡
Document dom = builder.parse(in);
```

ğŸ”– **Documentç±»**

- **åŒ…å**ï¼š`org.w3c.dom`
- **ä½œç”¨**ï¼šè¡¨ç¤ºæ•´ä¸ª XML æ–‡æ¡£ï¼Œæ˜¯ DOM æ ‘çš„æ ¹èŠ‚ç‚¹ï¼ˆæ‰€æœ‰å†…å®¹çš„å…¥å£ï¼‰ã€‚
- **ç‰¹ç‚¹**ï¼š

```ts
- ç›¸å½“äºâ€œå†…å­˜é‡Œçš„ XML æ–‡æ¡£å¯¹è±¡â€ã€‚
- å¯ä»¥é€šè¿‡å®ƒè·å–æ ¹å…ƒç´ ã€åˆ›å»ºå…ƒç´ ã€æ“ä½œèŠ‚ç‚¹ã€‚
- é€šè¿‡æ­¤ç±»å¯ä»¥è·å–XMLæ–‡ä»¶çš„å…ƒç´ DOMå¯¹è±¡
```

- **å¸¸ç”¨æ–¹æ³•**ï¼š

```ts
Element element = getDocumentElement()
è·å–æ ¹å…ƒç´ 

Element newStudent = createElement(String tagName)  
åˆ›å»ºæ–°å…ƒç´ 

Node node = createTextNode(String data)
åˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹

NodeList nodeList = getElementsByTagName(String tagName);
è·å–å…ƒç´ 
```

```java
// è·å–xmlæ–‡ä»¶çš„è¾“å…¥æµå¯¹è±¡
InputStream in = TestXml.class.getClassLoader().getResourceAsStream("students.xml");
// åˆ›å»ºdomå·¥å‚å¯¹è±¡
DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
// åˆ›å»ºdocumentBuilderå¯¹è±¡
DocumentBuilder builder = factory.newDocumentBuilder();
// åˆ›å»ºdomå¯¹è±¡
Document dom = builder.parse(in);
// è·å–å…ƒç´ 
NodeList studentNodeList = dom.getElementsByTagName("student");
```

```java
// 1. è·å–æ ¹å…ƒç´ 
Element root = dom.getDocumentElement();  // <students>

// 2. åˆ›å»ºä¸€ä¸ªæ–° <student> å…ƒç´ 
Element newStudent = dom.createElement("student");
newStudent.setAttribute("sid", "s003");

// 3. åˆ›å»º <sname> å…ƒç´ å¹¶åŠ ä¸Šæ–‡æœ¬
Element sname = dom.createElement("sname");
sname.appendChild(dom.createTextNode("Tom"));
newStudent.appendChild(sname);

// 4. æŒ‚åˆ°æ ¹å…ƒç´ ä¸Š
root.appendChild(newStudent);

// 5. è·å–æ‰€æœ‰ student èŠ‚ç‚¹
NodeList studentList = dom.getElementsByTagName("student");
System.out.println("æ€»å…±æœ‰ " + studentList.getLength() + " ä¸ªå­¦ç”Ÿ");

```

ğŸ”– **Elementç±»**

**åŒ…å**ï¼š`org.w3c.dom`

**ä½œç”¨**ï¼šè¡¨ç¤º XML æ–‡æ¡£ä¸­çš„ **å…ƒç´ èŠ‚ç‚¹**ï¼ˆå¸¦æ ‡ç­¾çš„éƒ¨åˆ†ï¼Œå¦‚ `<student>`ï¼‰ã€‚

**ç‰¹ç‚¹**ï¼š

- `Element` æ˜¯ `Node` çš„å­æ¥å£ï¼Œä¸“é—¨ç”¨æ¥æ“ä½œæ ‡ç­¾ã€‚
- å¯ä»¥è·å–å…ƒç´ åã€å­å…ƒç´ ã€å±æ€§ç­‰ã€‚

**å¸¸ç”¨æ–¹æ³•**ï¼š

```ts
getTagName() 
è·å–æ ‡ç­¾å

getAttribute(String name)
è·å–å±æ€§å€¼

getAttributes()
è·å–å±æ€§å€¼åˆ—è¡¨

setAttribute(String name, String value)  
è®¾ç½®å±æ€§

getElementsByTagName(String name)
è·å–å­å…ƒç´ åˆ—è¡¨

getTextContent()
è·å–å…ƒç´ å†…çš„æ–‡æœ¬å†…å®¹
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```java
Element student = (Element) root.getElementsByTagName("student").item(0);
String sid = student.getAttribute("sid");
String name = student.getElementsByTagName("sname").item(0).getTextContent();
```

ğŸ”– **Nodeç±»**

**åŒ…å**ï¼š`org.w3c.dom`

**ä½œç”¨**ï¼šXML æ–‡æ¡£ä¸­æ‰€æœ‰ DOM èŠ‚ç‚¹çš„çˆ¶æ¥å£ã€‚

**ç‰¹ç‚¹**ï¼š

- ä¸€ä¸ª XML æ–‡æ¡£é‡Œçš„æ‰€æœ‰éƒ¨åˆ†éƒ½æ˜¯ `Node`ï¼ˆå…ƒç´ ã€æ–‡æœ¬ã€æ³¨é‡Šç­‰ï¼‰ã€‚
- `Elementç±»`ã€`Textç±»`ã€`Commentç±»` éƒ½ç»§æ‰¿è‡ª `Node`ã€‚

**å¸¸ç”¨æ–¹æ³•**ï¼š

```ts
getNodeName()
èŠ‚ç‚¹åï¼ˆå…ƒç´ åã€å±æ€§åç­‰ï¼‰

getNodeValue()
èŠ‚ç‚¹å€¼ï¼ˆé€šå¸¸æ–‡æœ¬èŠ‚ç‚¹æ‰æœ‰å€¼ï¼‰

getNodeType()
èŠ‚ç‚¹ç±»å‹ï¼ˆå¦‚å…ƒç´ =1ï¼Œå±æ€§=2ï¼Œæ–‡æœ¬=3ï¼Œæ³¨é‡Š=8ï¼‰

getChildNodes()
è·å–å­èŠ‚ç‚¹åˆ—è¡¨

getParentNode()
è·å–çˆ¶èŠ‚ç‚¹

getFirstChild()
è·å–ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹
```

ç¤ºä¾‹ï¼š

```java
NodeList students = root.getChildNodes();
for (int i = 0; i < students.getLength(); i++) {
    Node node = students.item(i);
    if (node.getNodeType() == Node.ELEMENT_NODE) {
        System.out.println("å…ƒç´ èŠ‚ç‚¹: " + node.getNodeName());
    }
}

```

ğŸ”–  **NodeListç±»**

- **åŒ…å**ï¼š`org.w3c.dom`

- **ä½œç”¨**ï¼šè¡¨ç¤º **èŠ‚ç‚¹åˆ—è¡¨**ï¼Œå³æŸä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹é›†åˆã€‚

- **ç‰¹ç‚¹**ï¼š

  - `NodeList` ä¸æ˜¯ `List` æˆ– `ArrayList`ï¼Œæ›´åƒä¸€ä¸ªâ€œåªè¯»æ•°ç»„â€ã€‚

  * é€šè¿‡ç´¢å¼•æ¥è®¿é—®é‡Œé¢çš„èŠ‚ç‚¹ã€‚

  * ç”± DOM è§£æå™¨è¿”å›ï¼Œä¸èƒ½ç›´æ¥ new å‡ºæ¥ã€‚

  * å¸¸è§åœºæ™¯ï¼šé€šè¿‡ `getElementsByTagName()`ã€`getChildNodes()` å¾—åˆ°ã€‚

- æ–¹æ³•

```ts
int getLength()
è¿”å›åˆ—è¡¨ä¸­èŠ‚ç‚¹çš„æ•°é‡

Node item(int index)
æ ¹æ®ç´¢å¼•è·å–èŠ‚ç‚¹ï¼ˆä» 0 å¼€å§‹ï¼‰
```

```java
// è·å–æ‰€æœ‰ <student> å…ƒç´ 
NodeList students = dom.getElementsByTagName("student");

for (int i = 0; i < students.getLength(); i++) {
    Node node = students.item(i); // è·å–å•ä¸ª student èŠ‚ç‚¹
    if (node.getNodeType() == Node.ELEMENT_NODE) {
        Element student = (Element) node;
        String sid = student.getAttribute("sid");
        String name = student.getElementsByTagName("sname").item(0).getTextContent();
        String age = student.getElementsByTagName("age").item(0).getTextContent();
        String address = student.getElementsByTagName("address").item(0).getTextContent();
        System.out.println("å­¦å·:" + sid + ", å§“å:" + name + ", å¹´é¾„:" + age + ", åœ°å€:" + address);
    }
}
```

ğŸ”–   **æ€»ç»“ï¼š**

```ts
DocumentBuilderFactory â†’ å·¥å‚ï¼Œç”Ÿäº§è§£æå™¨ã€‚
DocumentBuilder â†’ è§£æå™¨ï¼Œè´Ÿè´£æŠŠ XML æ–‡ä»¶è¯»è¿›æ¥ã€‚
Document â†’ æ•´ä¸ª XML æ–‡æ¡£ï¼ˆæ ¹å¯¹è±¡ï¼‰ã€‚
Element â†’ XML å…ƒç´ ï¼ˆæ ‡ç­¾ï¼Œå¦‚ <student>ï¼‰ã€‚
Node â†’ æ‰€æœ‰èŠ‚ç‚¹çš„é€šç”¨æ¥å£ï¼ŒElement/Text/Comment éƒ½ç»§æ‰¿å®ƒã€‚
```

> **Java çš„ `org.w3c.dom` åŒ…** å’Œ **æµè§ˆå™¨é‡Œçš„ JavaScript DOM API** éƒ½æ˜¯åŸºäº **W3C DOM æ ‡å‡†** å®ç°çš„ï¼Œæ‰€ä»¥æœ‰å¾ˆå¤šæ–¹æ³•åã€æ¦‚å¿µæ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚
>
> ä¸åŒç‚¹åœ¨äºï¼š
>
> - Java å¸¸ç”¨äº **åç«¯/å·¥å…·ç±»åº”ç”¨**ï¼Œè§£æ XML æ–‡ä»¶ã€‚
> - JavaScript å¸¸ç”¨äº **å‰ç«¯**ï¼Œæ“ä½œ HTML é¡µé¢ã€‚

## TomCat

**Tomcat** æ˜¯ Apache æä¾›çš„å¼€æº **Servlet å®¹å™¨** å’Œ **Web æœåŠ¡å™¨**ã€‚

å®ƒå®ç°äº† **Servletã€JSPã€WebSocket** ç­‰è§„èŒƒï¼Œå¸¸ç”¨äº Java Web åº”ç”¨ã€‚

Tomcatæœ¬èº«ä¹Ÿæ˜¯Javaå†™çš„ï¼Œä»–çš„é‡Œè¾¹æœ‰å¾ˆå¤šjaråŒ…ã€‚

### å®‰è£…ä¸é…ç½®

ä¸‹è½½è§£å‹

```ts
å®˜ç½‘ï¼šhttps://tomcat.apache.org/
ä¸‹è½½ Binary Distribution â†’ Coreï¼Œä¾‹å¦‚ apache-tomcat-8.0.XX.zip

è§£å‹åˆ°ä»»æ„ç›®å½•ï¼Œä¾‹å¦‚ï¼š
D:\tools\tomcat8.x
```

**é…ç½®ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰**

```java
CATALINA_HOMEï¼šTomcat æ ¹ç›®å½•
JAVA_HOMEï¼šJDK æ ¹ç›®å½•ï¼ˆæ˜¯ç”±Javaå†™çš„ï¼‰
```

**ä¿®æ”¹ç«¯å£**

```ts
é»˜è®¤ 8080ï¼Œå¦‚æœå ç”¨ï¼Œå¯ä¿®æ”¹ conf/server.xml ä¸­ <Connector port="8080" ...>
```

**æŸ¥çœ‹æ—¥å¿—**

```java
logs/catalina.out æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
logs/localhost.*.log æŸ¥çœ‹åº”ç”¨æ—¥å¿—
```

**ä¿®æ”¹ç¼–ç ï¼Œæ§åˆ¶å°ä¹±ç **

```java
æ§åˆ¶å°ä¸­æ–‡ä¹±ç çš„é—®é¢˜
    æ‰¾åˆ° Tomcat ç›®å½•ä¸‹ conf æ–‡ä»¶å¤¹ä¸­çš„ logging.properties æ–‡ä»¶
    æ‰“å¼€è¯¥æ–‡ä»¶ï¼Œæ‰¾åˆ°`java.util.logging.ConsoleHandler.encoding`è¿™ä¸€é¡¹ä¿®æ”¹ç¼–ç ä¸ºGBK
    ä¿å­˜åå†é‡å¯Tomcatè¯•ä¸‹
    
çª—å£æ ‡é¢˜çš„ä¸­æ–‡ä¹±ç è§£å†³
	ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ bin ç›®å½•ä¸‹çš„ catalina.bat æ–‡ä»¶
   	ç”¨notepad++ç¼–è¾‘å™¨æŠŠ catalina.bat è¿›è¡Œè½¬ç æ“ä½œï¼Œç”±UTF-8è½¬ä¸ºANSIç¼–ç 
     ä¿®æ”¹åå†æ¬¡é‡å¯Tomcat
```

![image-20250905115440241](https://2216847528.oss-cn-beijing.aliyuncs.com/asset/image-20250905115440241.png)

**ä½œä¸ºæœåŠ¡å¯åŠ¨**

æŒ‰ä¸‹å¿«æ·é”®`Win`+`r`æ‰“å¼€`cmd`

åˆ‡æ¢åˆ° Tomcat9 å®‰è£…ç›®å½•ä¸‹çš„ bin ç›®å½•ï¼Œè¾“å…¥`service.bat install`å›è½¦ï¼Œæˆ–è€… ç›´æ¥æ‹–åŠ¨`service.bat`æ–‡ä»¶åˆ°`cmd`çª—å£ï¼Œæ¥ç€è¾“å…¥`install`ä¹Ÿå¯ã€‚å‡ºç°`The service 'Tomcat9' has been installed.`å°±è¯´æ˜æœåŠ¡å®‰è£…æˆåŠŸäº†ã€‚ä¸ç¡®å®šçš„è¯å¯ä»¥æ‰“å¼€`æœåŠ¡`çœ‹ä¸‹ã€‚

![image-20250905162322882](https://2216847528.oss-cn-beijing.aliyuncs.com/asset/image-20250905162322882.png)

(å¦å¤–å¦‚æœæ—¥åéœ€è¦å¸è½½TomcatæœåŠ¡çš„è¯ï¼Œæ‰§è¡Œ`service.bat remove Tomcat9`å³å¯å®ŒæˆæœåŠ¡å¸è½½)

**ä¸¤ä¸ªå¯åŠ¨æ–‡ä»¶çš„åŒºåˆ«ï¼š**

```ts
åœ¨ Windows ä¸‹å¯åŠ¨ Tomcatï¼Œä½ ä¼šçœ‹åˆ° bin ç›®å½•ä¸‹æœ‰ä¸¤ä¸ªå¸¸ç”¨è„šæœ¬
startup.bat
ä½œç”¨ï¼šå¿«æ·å¯åŠ¨è„šæœ¬
æœ¬è´¨ä¸Šå®ƒåªæ˜¯åšäº†ä¸€ç‚¹ç¯å¢ƒæ£€æŸ¥ï¼Œç„¶åè°ƒç”¨ catalina.bat startã€‚
æ‰€ä»¥æˆ‘ä»¬å¹³å¸¸åŒå‡» startup.batï¼ŒTomcat å°±èƒ½è·‘èµ·æ¥ã€‚

catalina.bat
ä½œç”¨ï¼šæ ¸å¿ƒå¯åŠ¨è„šæœ¬
å®ƒæ‰æ˜¯çœŸæ­£å¯åŠ¨ Tomcat çš„è„šæœ¬ï¼Œæ”¯æŒä¸åŒçš„å‚æ•°ï¼Œä¾‹å¦‚ï¼š
catalina.bat start    :: å¯åŠ¨
catalina.bat stop     :: åœæ­¢
catalina.bat run      :: å‰å°è¿è¡Œï¼ˆè°ƒè¯•ç”¨ï¼‰
catalina.bat configtest :: æµ‹è¯•é…ç½®
```

**ä¿®æ”¹ç«¯å£å·**

```java
åœ¨ conf ç›®å½•ä¸­ï¼Œä¿®æ”¹server.xmlé…ç½®æ–‡ä»¶
```

### éƒ¨ç½² Web

æ–¹å¼ä¸€ï¼šwebapps ç›®å½•

```java
å°†ä½ çš„ .war æ–‡ä»¶æ”¾åˆ° webapps ç›®å½•ï¼ŒTomcat ä¼šè‡ªåŠ¨è§£å‹éƒ¨ç½²ã€‚
    
è®¿é—®ï¼šhttp://localhost:8080/é¡¹ç›®å
```

æ–¹å¼äºŒï¼š`server.xml` é…ç½®

```java
åœ¨ conf/server.xml ä¸­é…ç½® <Context>ï¼ŒæŒ‡å®šåº”ç”¨è·¯å¾„å’Œç›®å½•ã€‚
```

### IDEAæ•´åˆTOMCAT

1ã€åˆ›å»ºJavaWebé¡¹ç›®ï¼š

```java
æ–¹å¼1ï¼šç›´æ¥åœ¨åˆ›å»ºé¡¹ç›®çš„æ—¶å€™å‹¾é€‰ Web Application 4.0 ç‰ˆæœ¬
    
æ–¹å¼2ï¼šåœ¨å·²åˆ›å»ºå¥½çš„é¡¹ç›®ä¸­ï¼Œåœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸Šï¼Œé¼ æ ‡å³é”®ï¼ŒAdd Framework Support...
    ç„¶åå‹¾é€‰ Web Applicationï¼Œå°±ä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•æ–°å¢ä¸€ä¸ªwebç›®å½•ï¼Œå°±æ˜¯tomcatä¸­çš„webappé‡Œé¢çš„é¡¹ç›®ç›®å½•
```

2ã€åœ¨IDEAä¸­é…ç½®Tomcatè·¯å¾„ï¼Œç‚¹å‡» Edit Configurationsã€‚ 

![image-20250904173607139](https://2216847528.oss-cn-beijing.aliyuncs.com/asset/image-20250904173607139.png)

â€‹	2.1 ç‚¹å‡» + å·

![image-20250904173643227](https://2216847528.oss-cn-beijing.aliyuncs.com/asset/image-20250904173643227.png)

â€‹	2.2 é€‰æ‹©æœ¬åœ° Tomcat

![image-20250904173739759](https://2216847528.oss-cn-beijing.aliyuncs.com/asset/image-20250904173739759.png)

â€‹	2.3ã€ é…ç½®Tomcatæ ¹ç›®å½•ï¼šæ ¹ç›®å½•ï¼Œbinç›®å½•çš„ä¸Šä¸€çº§å³å¯ã€‚

â€‹	2.4ã€ ç‚¹å‡» Deployment éƒ¨ç½²é€‰é¡¹å¡ï¼Œç‚¹å‡» + å·ï¼Œé€‰æ‹©Artifactï¼Œé€‰æ‹©éƒ¨ç½²åŒ…ã€‚

â€‹	2.5ã€ é…ç½® Application contentï¼Œ/ ä¸èƒ½å°‘ï¼Œåé¢xxxä¸º urlä¸­çš„è·¯å¾„ã€‚

```ts
localhost:8080/xxx
```

![image-20250905113528106](https://2216847528.oss-cn-beijing.aliyuncs.com/asset/image-20250905113528106.png)

â€‹	2.6 ã€é…ç½®æœåŠ¡å¯åŠ¨åè®¿é—®çš„åœ°å€

![image-20250905113858462](https://2216847528.oss-cn-beijing.aliyuncs.com/asset/image-20250905113858462.png)

```java
http://localhost:8080/fruit/index.html
```

3ã€å¯åŠ¨Tomcatï¼Œä½¿ç”¨debugæ¨¡å¼ï¼ˆrunæ¨¡å¼ï¼‰ã€‚

4ã€å¦‚æœå‡ºç°å¤šä¸ª éƒ¨ç½²åŒ…ï¼Œåˆ™å¯ä»¥é€šè¿‡ project structureï¼Œæ¥è¿›è¡Œåˆ é™¤å¤šä½™çš„ï¼Œéƒ¨ç½²åŒ…ã€‚

â€‹	4.1ã€é€‰ä¸­é¡¹ç›®æ–‡ä»¶å¤¹ï¼Œç„¶åç‚¹å‡»Fileï¼Œå°±ä¼šå‡ºç°ã€‚

![image-20250905112937580](https://2216847528.oss-cn-beijing.aliyuncs.com/asset/image-20250905112937580.png)

â€‹	4.2ã€æ‰¾åˆ° Artifacts é€‰é¡¹å¡ï¼Œå°±å¯ä»¥åˆ é™¤ã€‚ç„¶åç‚¹å‡» + å·ï¼Œé€‰æ‹© WebApplication:Explodedï¼Œé€‰æ‹© From Moduleã€‚é€‰æ‹©å¯¹åº”çš„ java-web é¡¹ç›®ï¼ˆæœ‰çš„æ˜¯Javaé¡¹ç›®ï¼Œæœ‰çš„æ˜¯Webé¡¹ç›®ï¼Œæœ‰çš„æ˜¯JavaWebé¡¹ç›®ï¼‰

## XMLè¯­æ³•

HTMLè¯­è¨€æ˜¯xmlè¯­è¨€çš„å­é›†ã€‚xml çš„æ ‡ç­¾å±æ€§å’Œhtml çš„æ ‡ç­¾å±æ€§æ˜¯éå¸¸ç±»ä¼¼çš„ï¼Œä¸€ä¸ªæ ‡ç­¾ä¸Šå¯ä»¥ä¹¦å†™å¤šä¸ªå±æ€§ã€‚æ¯ä¸ªå±æ€§çš„å€¼å¿…é¡»ä½¿ç”¨å¼•å·å¼•èµ·æ¥ã€‚

### XMLç»„æˆ

(1) XML å£°æ˜ï¼ˆDeclarationï¼‰

```ts
å›ºå®šå†™æ³•ï¼Œæ°¸è¿œæ”¾åœ¨ç¬¬ä¸€è¡Œã€‚æŒ‡æ˜ XML ç‰ˆæœ¬ã€æ–‡æ¡£ç¼–ç æ–¹å¼ã€‚

<?xml version="1.0" encoding="UTF-8"?>
```

(2) æ–‡æ¡£ç±»å‹å®šä¹‰ï¼ˆDTD, Document Type Definitionï¼‰

```ts
ä½œç”¨ï¼šçº¦æŸå’Œè§„èŒƒ XML æ–‡æ¡£ä¸­å…ƒç´ ã€å±æ€§çš„å†™æ³•ã€‚
ä½ç½®ï¼šXML å£°æ˜ä¹‹åï¼ŒXML æ­£æ–‡ä¹‹å‰ã€‚
å¯é€‰ï¼šå¯ä»¥æ²¡æœ‰ã€‚
```

(3) XML æ­£æ–‡ï¼ˆContent / Document Bodyï¼‰

```ts
XML çš„ä¸»è¦å†…å®¹ï¼Œå¿…é¡»æœ‰ å”¯ä¸€æ ¹å…ƒç´ 
```

```java
<note>
    <to>Tom</to>
    <from>Jerry</from>
    <heading>Reminder</heading>
    <body>Donâ€™t forget XML homework!</body>
</note>
```

> XML å¯ä»¥çœç•¥ DTD

å®Œæ•´å†™æ³•ï¼ˆå£°æ˜ + DTD + æ­£æ–‡ï¼‰

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE note SYSTEM "note.dtd">
<note> ... </note>

```

ç®€å†™ï¼ˆåªæœ‰å£°æ˜ + æ­£æ–‡ï¼‰

```
<?xml version="1.0" encoding="UTF-8"?>
<note> ... </note>

```

ç¤ºä¾‹ï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>

<!-- DOCTYPE : è¡¨ç¤ºå¼€å§‹è¿›è¡Œæ–‡æ¡£ç±»å‹å®šä¹‰
     students è¡¨ç¤ºå½“å‰æ–‡æ¡£çš„æ ¹å…ƒç´ æ˜¯students
     ELEMENT : è¡¨ç¤ºå¼€å§‹å®šä¹‰å…ƒç´ 
     students (student*) è¡¨ç¤º studentsè¿™ä¸ªå…ƒç´ å†…éƒ¨æœ‰0~nä¸ªå­å…ƒç´ student
     student (sname ,age , address) è¡¨ç¤ºstudenté‡Œé¢ä¾æ¬¡æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªsname,age,address
     #PCDATA ç›¸å½“äºStringï¼Œç›¸å½“äºæ•°æ®åº“ä¸­çš„varcharï¼Œè¡¨ç¤ºå­—ç¬¦ä¸²ï¼Œæ–‡æœ¬
     ATTLIST student sid ID #REQUIRED ATTLISTè¡¨ç¤ºå±æ€§åˆ—è¡¨ï¼Œè¡¨ç¤ºstudentçš„å±æ€§sid
     IDç›¸å½“äºæ•°æ®åº“çš„ä¸»é”®ï¼ˆå”¯ä¸€ï¼‰
     #REQUIRED ç›¸å½“äºæ•°æ®åº“çš„not null , è¡¨ç¤ºå¿…é¡»çš„ï¼Œä¸èƒ½æ²¡æœ‰
     IDREF è¡¨ç¤ºè¿™ä¸€åˆ—çš„å–å€¼å¿…é¡»æ¥æºäºæŸä¸€ä¸ªIDçš„å€¼
     #IMPLIED è¡¨ç¤ºè¿™ä¸ªå±æ€§å¯æœ‰å¯æ— 
-->

<!DOCTYPE students[
    <!ELEMENT students (student*)>
    <!ELEMENT student (sname ,age , address)>
    <!ELEMENT sname (#PCDATA)>
    <!ELEMENT age (#PCDATA)>
    <!ELEMENT address (#PCDATA)>
    <!ATTLIST student sid ID #REQUIRED>
    <!ATTLIST student gid IDREF #IMPLIED>
]>

<students>
    <student sid="s001">
        <sname>jim</sname>
        <age>18</age>
        <address>USA</address>
    </student>
    <student sid="s002" gid="s001">
        <sname>é¸ æ‘©æ™º</sname>
        <age>30</age>
        <address>åè•ƒ</address>
    </student>
</students>
```



### è¯­æ³•è§„åˆ™

- **å¿…é¡»æœ‰ä¸€ä¸ªæ ¹å…ƒç´ **ï¼ˆå”¯ä¸€ï¼‰ã€‚
- **æ ‡ç­¾å¿…é¡»æˆå¯¹å‡ºç°**ï¼Œå¤§å°å†™æ•æ„Ÿã€‚
- **å±æ€§å€¼å¿…é¡»åŠ å¼•å·**ï¼ˆå•åŒå¼•å·å‡å¯ï¼‰ã€‚
- **å¿…é¡»æ­£ç¡®åµŒå¥—**ï¼ˆä¸å…è®¸äº¤å‰ï¼‰ã€‚

```xml
<a><b></b></a>   <!-- æ­£ç¡® -->
<a><b></a></b>   <!-- é”™è¯¯ -->
```

- **ç‰¹æ®Šç¬¦å·å¿…é¡»è½¬ä¹‰**

```xml
&lt;ã€&gt;ã€&amp;
```

- **æ³¨é‡Šæ ¼å¼ï¼š** 

```xml
<!-- æ³¨é‡Šå†…å®¹ -->
```

- **å¯ä»¥åŒ…å« CDATA åŒºå—**ï¼ŒåŸæ ·ä¿å­˜å†…å®¹ï¼š

```xml
<![CDATA[ <username>Tom & Jerry</username> ]]>
```

### ä¸¤ç§è§„èŒƒ

(1) æ ¼å¼è‰¯å¥½ï¼ˆWell-Formedï¼‰

- å¿…é¡»æ»¡è¶³ XML åŸºæœ¬è¯­æ³•è§„åˆ™
- åªè¦è¯­æ³•æ²¡é”™ï¼Œå°±ç®—æ ¼å¼è‰¯å¥½

(2) æœ‰æ•ˆï¼ˆValidï¼‰

- åœ¨ **æ ¼å¼è‰¯å¥½** çš„åŸºç¡€ä¸Šï¼Œè¿˜å¿…é¡» **ç¬¦åˆ DTD æˆ– XML Schema çš„çº¦æŸ**ã€‚
- ç®€å•ç†è§£å°±æ˜¯ : æœ‰æ•ˆ = è¯­æ³•æ­£ç¡® + å†…å®¹ç¬¦åˆè§„åˆ™

### è§£æXML

åœ¨ Java é‡Œè§£æ XML æ–‡ä»¶çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œå¸¸è§çš„æœ‰ä¸‰å¤§ç±»ï¼š**DOMã€SAXã€StAX**ã€‚å¦å¤–è¿˜æœ‰ä¸€äº›å¸¸ç”¨çš„ç¬¬ä¸‰æ–¹åº“ï¼ˆJDOMã€dom4jã€Jacksonã€FastXML ç­‰ï¼‰

æŠŠxmlæ–‡ä»¶æ”¾ç½®åœ¨ src çš„åŒçº§ç›®å½•ä¸‹ `resources` ï¼ˆæ²¡æœ‰åˆ™åˆ›å»ºï¼‰ï¼Œç„¶åæŠŠè¿™ä¸ªæ–‡ä»¶å¤¹å®šä¹‰ä¸º`Resources Root`æ–‡ä»¶å¤¹ï¼ŒæŠŠstudents.xmlæ–‡ä»¶æ”¾åœ¨é‡Œè¾¹ã€‚`resources/students.xml`

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE students[
    <!ELEMENT students (student*)>
    <!ELEMENT student (sname ,age , address)>
    <!ELEMENT sname (#PCDATA)>
    <!ELEMENT age (#PCDATA)>
    <!ELEMENT address (#PCDATA)>
    <!ATTLIST student sid ID #REQUIRED>
    <!ATTLIST student gid IDREF #IMPLIED>
]>

<students>
    <student sid="s001">
        <sname>jim</sname>
        <age>18</age>
        <address>USA</address>
    </student>
    <student sid="s002" gid="s001">
        <sname>é¸ æ‘©æ™º</sname>
        <age>30</age>
        <address>åè•ƒ</address>
    </student>
</students>
```



#### DOMè§£æ

æŠŠæ•´ä¸ª XML æ–‡æ¡£ä¸€æ¬¡æ€§åŠ è½½åˆ°å†…å­˜ï¼Œæ„é€ æˆæ ‘å½¢ç»“æ„ï¼ˆ`Document` å¯¹è±¡ï¼‰ã€‚é€‚åˆå°å‹ XMLï¼Œæ“ä½œæ–¹ä¾¿

```java
import org.w3c.dom.*;
import javax.xml.parsers.*;
import java.io.File;

public class DOMParseExample {
    public static void main(String[] args) {
        try {
            // 1. åˆ›å»º DocumentBuilderFactory
            DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
            // 2. åˆ›å»º DocumentBuilder
            DocumentBuilder builder = factory.newDocumentBuilder();
            // 3. è§£æ XML æ–‡ä»¶
            Document document = builder.parse(new File("students.xml"));
            // 4. è·å–æ ¹å…ƒç´ 
            Element root = document.getDocumentElement();
            System.out.println("æ ¹å…ƒç´ : " + root.getNodeName());

            // 5. è·å–æ‰€æœ‰ student èŠ‚ç‚¹
            NodeList studentList = root.getElementsByTagName("student");
            for (int i = 0; i < studentList.getLength(); i++) {
                Element student = (Element) studentList.item(i);
                String sid = student.getAttribute("sid");
                String name = student.getElementsByTagName("sname").item(0).getTextContent();
                String age = student.getElementsByTagName("age").item(0).getTextContent();
                String address = student.getElementsByTagName("address").item(0).getTextContent();

                System.out.println(sid + " | " + name + " | " + age + " | " + address);
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}

```

ç¤ºä¾‹2ï¼š

```java
import org.junit.Test;
import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;
import org.xml.sax.SAXException;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;
import java.io.IOException;
import java.io.InputStream;

public class TestXml {
    @Test
    public void TestXml() throws ParserConfigurationException, IOException, SAXException {
        // è·å–xmlæ–‡ä»¶çš„è¾“å…¥æµå¯¹è±¡
        InputStream in = TestXml.class.getClassLoader().getResourceAsStream("students.xml");
        // åˆ›å»ºdomå·¥å‚å¯¹è±¡
        DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
        // åˆ›å»ºdocumentBuilderå¯¹è±¡
        DocumentBuilder builder = factory.newDocumentBuilder();
        // åˆ›å»ºDOMå¯¹è±¡
        Document dom = builder.parse(in);
        // è·å–å…ƒç´ 
        NodeList studentNodeList = dom.getElementsByTagName("student");
        for (int i = 0; i < studentNodeList.getLength(); i++) {
            // è·å–NodeListä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ èŠ‚ç‚¹
            Node nodeItem = studentNodeList.item(i);
            // æŠŠNodeç±»å‹ å¼ºè½¬ä¸º Elementç±»å‹
            Element eleItem = (Element) nodeItem;
            // ä½¿ç”¨Elementä¸­çš„æ–¹æ³•ï¼Œè·å–æ ‡ç­¾ä¸­çš„å±æ€§
            String sid = eleItem.getAttribute("sid");
            String gid = eleItem.getAttribute("gid");
            // æ‰“å°
            System.out.println("sid å’Œ gid åˆ†åˆ«æ˜¯ " + sid + gid);
            // è·å–æ ‡ç­¾å†…çš„å­æ ‡ç­¾
            NodeList childNodes = eleItem.getChildNodes();
            // éå†å­æ ‡ç­¾èŠ‚ç‚¹
            for (int j = 0; j < childNodes.getLength(); j++) {
                // è·å–å­æ ‡ç­¾å†…çš„èŠ‚ç‚¹å…ƒç´ 
                Node nodeChildItem = childNodes.item(j);
                // åˆ¤æ–­å­æ ‡ç­¾å†…èŠ‚ç‚¹ç±»å‹æ˜¯å¦æ˜¯å…ƒç´ ç±»å‹
                if (nodeChildItem.getNodeType() == Node.ELEMENT_NODE){
                    // è·å–å­èŠ‚ç‚¹çš„å†…çš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹
                    Node firstChild = nodeChildItem.getFirstChild();
                    // å¦‚æœç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ˜¯æ–‡æœ¬èŠ‚ç‚¹åˆ™è¯»å–å€¼
                    if (firstChild.getNodeType() == Node.TEXT_NODE){
                        String nodeValue = firstChild.getNodeValue();
                        System.out.println("nodeValue = " + nodeValue);
                    }
                }
            }
        }
    }
}

```



#### ç¬¬ä¸‰æ–¹åº“

åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¾ˆå¤šäººç”¨ç¬¬ä¸‰æ–¹åº“æ¥è§£æ XMLï¼Œæ“ä½œæ›´ç®€æ´ï¼š

- **JDOM**ï¼šæ¯” DOM/SAX ç®€å•ã€‚
- **dom4j**ï¼šåŠŸèƒ½å¼ºå¤§ï¼ŒHibernateã€Spring æ—©æœŸå¤§é‡ä½¿ç”¨ã€‚
- **Jackson / Gson**ï¼šæ”¯æŒ XML <-> JSON è½¬æ¢ã€‚

**å®é™…å¼€å‘**ï¼šæ›´å¤šç”¨ dom4j æˆ–è€…ç›´æ¥è½¬ JSONã€‚

```java

```

