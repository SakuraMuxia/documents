# å‡½æ•°

## åˆ†ç»„å‡½æ•°

âš¡ï¸ **åˆ†ç»„å‡½æ•°ï¼š**

- **å¯¹å¤šè¡Œæ•°æ®è¿›è¡Œè®¡ç®—ï¼Œè¿”å›ä¸€ä¸ªç»“æœå€¼ã€‚**
- å¸¸ç”¨äº **`GROUP BY`** æˆ–ç»Ÿè®¡åˆ†æã€‚
- ä½œç”¨ï¼šå¯¹ä¸€ç»„æ•°æ®è¿›è¡Œæ±‡æ€»ç»Ÿè®¡ã€‚

| å‡½æ•°      | ä½œç”¨       |
| --------- | ---------- |
| `COUNT()` | ç»Ÿè®¡è¡Œæ•°   |
| `SUM()`   | è®¡ç®—æ€»å’Œ   |
| `AVG()`   | è®¡ç®—å¹³å‡å€¼ |
| `MAX()`   | æ±‚æœ€å¤§å€¼   |
| `MIN()`   | æ±‚æœ€å°å€¼   |

ä½¿ç”¨ç¤ºä¾‹ï¼š

```sql
-- å»ºè¡¨ç¤ºä¾‹
CREATE TABLE sales (
    id INT,
    product VARCHAR(20),
    amount DECIMAL(10,2)
);

INSERT INTO sales VALUES
(1, 'æ‰‹æœº', 2000),
(2, 'ç”µè„‘', 5000),
(3, 'æ‰‹æœº', 3000),
(4, 'å¹³æ¿', 2500);

-- ç¤ºä¾‹1: æ±‚æ€»é”€å”®é¢
SELECT SUM(amount) AS total_sales FROM sales;

-- ç¤ºä¾‹2: æ±‚å¹³å‡é”€å”®é¢
SELECT AVG(amount) AS avg_sales FROM sales;

-- ç¤ºä¾‹3: æŒ‰äº§å“åˆ†ç»„ï¼Œç»Ÿè®¡é”€å”®æ•°é‡ & æ€»é¢
SELECT product, COUNT(*) AS sales_count, SUM(amount) AS total
FROM sales
GROUP BY product;

```

```sql
-- æŸ¥è¯¢å¹³å‡å¹´é¾„ï¼Œèšåˆå‡½æ•°ï¼ˆåˆ†ç»„å‡½æ•°ï¼‰æŠŠå¤šæ¡æ•°ç»„èšåˆæˆä¸€æ¡æ•°æ®
select avg(employee.empage) as "å¹³å‡å¹´é¾„" from employee;

-- ç»Ÿè®¡æ±‚å’Œ
select sum(employee.empscore) as "ç»©æ•ˆæ€»å’Œ" from employee;

-- ç»Ÿè®¡æœ€å¤§çš„å¹´é¾„
select max(employee.empage) from employee;

-- ç»Ÿè®¡æœ€å°çš„å¹´é¾„
select min(employee.empage) from employee;

-- ç»Ÿè®¡è®°å½•æ•°
-- ç»Ÿè®¡å‘˜å·¥è¡¨ä¸­æ€»å…±æœ‰å¤šå°‘æ¡è®°å½•æ•°ï¼Œä»¥ä¸‹ä¸¤ä¸ªä½œç”¨ç›¸åŒ
select count(*) as "æ€»è®°å½•æ•°" from employee;
select count(1) as "æ€»è®°å½•æ•°" from employee;
```

## å•è¡Œå‡½æ•°

- **ä½œç”¨äºæ¯ä¸€è¡Œï¼Œè¿”å›ä¸€ä¸ªç»“æœã€‚**
- ä¸æ”¹å˜æ•°æ®çš„è¡Œæ•°ã€‚
- å¸¸ç”¨äºæŸ¥è¯¢ç»“æœçš„æ ¼å¼åŒ–ã€æ•°æ®å¤„ç†ã€‚

### æ•°å€¼å‡½æ•°

| å‡½æ•°          | ä½œç”¨            |
| ------------- | --------------- |
| `ABS(x)`      | ç»å¯¹å€¼          |
| `ROUND(x, d)` | å››èˆäº”å…¥åˆ° d ä½ |
| `FLOOR(x)`    | å‘ä¸‹å–æ•´        |
| `CEIL(x)`     | å‘ä¸Šå–æ•´        |
| `MOD(x,y)`    | å–ä½™            |

```sql
-- æ±‚ç»å¯¹å€¼
select abs(-123);

-- å››èˆäº”å…¥
select round(3.3);

-- å‘ä¸‹å–æ•´
select floor(3.3);

-- å‘ä¸Šå–æ•´
select ceil(3.3);

-- å–ä½™
select mod(10,3);

```

### å­—ç¬¦ä¸²å‡½æ•°

| å‡½æ•°                             | ä½œç”¨                     |
| -------------------------------- | ------------------------ |
| `LENGTH(str)`                    | è¿”å›å­—ç¬¦ä¸²é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰ |
| `CONCAT(a,b,...)`                | æ‹¼æ¥å­—ç¬¦ä¸²               |
| `UPPER(str)` / `LOWER(str)`      | å¤§å°å†™è½¬æ¢               |
| `TRIM(str)`                      | å»æ‰å‰åç©ºæ ¼             |
| `SUBSTRING(str,pos,len)`         | æˆªå–å­—ç¬¦ä¸²               |
| `REPLACE(str, from_str, to_str)` | æ›¿æ¢å­—ç¬¦ä¸²               |

ğŸ”– ä½¿ç”¨ç¤ºä¾‹ï¼š

```sql
-- å­—ç¬¦ä¸²é•¿åº¦
select length('Hello World');

-- æ‹¼æ¥
select concat('Hello',' ','SQL');

-- è½¬å¤§å†™
select upper('hello');

-- å»æ‰å‰åç©ºæ ¼
select trim('   SQL   ');

-- æˆªå–å­—ç¬¦ä¸²
select substring('abcdef', 2, 3);

-- æ›¿æ¢
select replace('hello world','world','SQL');

```

### æ—¥æœŸå‡½æ•°

| å‡½æ•°                                     | ä½œç”¨             |
| ---------------------------------------- | ---------------- |
| `NOW()`                                  | è¿”å›å½“å‰æ—¥æœŸæ—¶é—´ |
| `CURDATE()` / `CURTIME()`                | å½“å‰æ—¥æœŸ / æ—¶é—´  |
| `YEAR(date)`ã€`MONTH(date)`ã€`DAY(date)` | æå–å¹´ã€æœˆã€æ—¥   |
| `DATE_ADD(date, INTERVAL n unit)`        | æ—¥æœŸåŠ å‡         |
| `DATEDIFF(d1,d2)`                        | æ—¥æœŸå·®ï¼ˆå¤©æ•°ï¼‰   |

ğŸ”– ä½¿ç”¨ç¤ºä¾‹ï¼š

```sql
-- å½“å‰æ—¥æœŸæ—¶é—´
select now();

-- åªå–æ—¥æœŸ
select curdate();

-- æå–å¹´ã€æœˆã€æ—¥
select year(now()), month(now()), day(now());

-- æ—¥æœŸåŠ å‡
select date_add('2025-08-19', interval 7 day);

-- æ—¥æœŸå·®
select datediff('2025-08-19','2025-08-01');

```

### ç³»ç»Ÿä¿¡æ¯å‡½æ•°

| å‡½æ•°               | ä½œç”¨                  |
| ------------------ | --------------------- |
| `USER()`           | å½“å‰ç”¨æˆ·              |
| `DATABASE()`       | å½“å‰æ•°æ®åº“            |
| `VERSION()`        | æ•°æ®åº“ç‰ˆæœ¬            |
| `LAST_INSERT_ID()` | æœ€è¿‘ä¸€æ¬¡æ’å…¥çš„è‡ªå¢ ID |

ğŸ”– ä½¿ç”¨ç¤ºä¾‹ï¼š

```sql
-- å½“å‰ç”¨æˆ·
select user();

-- å½“å‰æ•°æ®åº“
select database();

-- MySQL ç‰ˆæœ¬
select version();

-- æœ€è¿‘ä¸€æ¬¡æ’å…¥ ID
insert into test(name) values('abc');
select last_insert_id();

```

### æ¡ä»¶åˆ¤æ–­å‡½æ•°

| å‡½æ•°                                  | ä½œç”¨                     |
| ------------------------------------- | ------------------------ |
| `IF(expr, v1, v2)`                    | æ¡ä»¶æˆç«‹è¿”å› v1ï¼Œå¦åˆ™ v2 |
| `IFNULL(v1, v2)`                      | v1 ä¸º NULL æ—¶è¿”å› v2     |
| `CASE WHEN ... THEN ... ELSE ... END` | å¤šæ¡ä»¶åˆ¤æ–­               |

ğŸ”– ä½¿ç”¨ç¤ºä¾‹ï¼š

```sql
-- IF åˆ¤æ–­
select if(10>5, 'å¤§äº', 'å°äº');

-- IFNULL
select ifnull(null, 'é»˜è®¤å€¼');

-- CASEï¼Œä½¿ç”¨æ–¹å¼1ï¼šæ¡ä»¶æ˜¯ä¸€ä¸ªåŒºé—´
select 
  case 
    when score >= 90 then 'ä¼˜ç§€'
    when score >= 60 then 'åŠæ ¼'
    else 'ä¸åŠæ ¼'
  end as result
from exam;


-- CASEï¼Œä½¿ç”¨æ–¹å¼2ï¼šæ¡ä»¶æ˜¯å¸¸é‡
select 
  case 
    when 100 then 'æ»¡åˆ†'
    when 60 then 'åŠæ ¼'
    else 'ä¸åŠæ ¼'
  end as result
from exam;

```

### å…¶ä»–å‡½æ•°

| å‡½æ•°       | ä½œç”¨           |
| ---------- | -------------- |
| `UUID()`   | ç”Ÿæˆå”¯ä¸€æ ‡è¯†ç¬¦ |
| `MD5(str)` | è®¡ç®— MD5 å€¼    |
| `RAND()`   | ç”Ÿæˆéšæœºæ•°     |

ğŸ”– ä½¿ç”¨ç¤ºä¾‹ï¼š

```sql
-- UUID
select uuid();

-- MD5
select md5('123456');

-- éšæœºæ•°
select rand();

```

### çª—å£å‡½æ•°

ï¼ˆMysql 8.0æ–°ç‰¹æ€§ï¼‰

| å‡½æ•°                         | ä½œç”¨                       |
| ---------------------------- | -------------------------- |
| `ROW_NUMBER()`               | è¡Œå·                       |
| `RANK()`                     | æ’åï¼ˆæœ‰å¹¶åˆ—ï¼Œè·³è¿‡åæ¬¡ï¼‰   |
| `DENSE_RANK()`               | æ’åï¼ˆæœ‰å¹¶åˆ—ï¼Œä¸è·³è¿‡åæ¬¡ï¼‰ |
| `SUM()/AVG()/COUNT() OVER()` | çª—å£èšåˆ                   |
| `RANK() OVER(...)`           | ç»™ç»“æœé›†ä¸­çš„æ¯ä¸€è¡Œåˆ†é…æ’å |

ğŸ”– ä½¿ç”¨ç¤ºä¾‹ï¼š

```sql
-- æŒ‰æˆç»©æ’å
select 
  name, score,
  row_number() over(order by score desc) as rownum,
  rank() over(order by score desc) as ranknum,
  dense_rank() over(order by score desc) as denserank
from exam;

-- åˆ†ç»„å†…æ±‚å¹³å‡
select 
  dept, name, salary,
  avg(salary) over(partition by dept) as avg_salary
from employee;

```

```sql
-- RANK() OVER(...) çª—å£å‡½æ•°ç¤ºä¾‹

SELECT dept, name, salary,
       RANK() OVER(PARTITION BY dept ORDER BY salary DESC) AS rnk
FROM employee
```

### åŠ å¯†å‡½æ•°

| å‡½æ•°                    | ä½œç”¨                                              |
| ----------------------- | ------------------------------------------------- |
| `MD5(str)`              | è¿”å›å­—ç¬¦ä¸²çš„ MD5 128 ä½å“ˆå¸Œå€¼ï¼ˆ32ä½16è¿›åˆ¶å­—ç¬¦ä¸²ï¼‰ |
| `SHA(str)`              | è¿”å›å­—ç¬¦ä¸²çš„ SHA1 å“ˆå¸Œå€¼                          |
| `SHA2(str, len)`        | ä½¿ç”¨ SHA2 ç®—æ³•åŠ å¯†ï¼Œlen=224/256/384/512           |
| `PASSWORD(str)`         | è¿”å› MySQL å†…éƒ¨ä½¿ç”¨çš„åŠ å¯†ä¸²ï¼ˆä¸æ¨èç”¨æˆ·è‡ªè¡Œä½¿ç”¨ï¼‰ |
| `ENCODE(str, key)`      | ä½¿ç”¨ key å¯¹ str è¿›è¡ŒåŠ å¯†                          |
| `DECODE(str, key)`      | ä½¿ç”¨ key å¯¹åŠ å¯†ä¸²è¿›è¡Œè§£å¯†                         |
| `AES_ENCRYPT(str, key)` | ä½¿ç”¨ AES ç®—æ³•åŠ å¯†                                 |
| `AES_DECRYPT(str, key)` | ä½¿ç”¨ AES ç®—æ³•è§£å¯†                                 |

ğŸ”– ä½¿ç”¨ç¤ºä¾‹ï¼š

```sql
-- ä½¿ç”¨ MD5 åŠ å¯†
select md5('123456') as md5_pwd;

-- ä½¿ç”¨ SHA1 åŠ å¯†
select sha('hello world') as sha1_val;

-- ä½¿ç”¨ SHA2 åŠ å¯†ï¼ˆ256ä½ï¼‰ï¼Œç”Ÿæˆçš„é•¿åº¦ä¸º 256/4 = 64ä½çš„å­—ç¬¦ä¸²
select sha2('hello world', 256) as sha2_val;

-- ä½¿ç”¨ AES åŠ å¯†å’Œè§£å¯†
select 
  aes_encrypt('secret_data', 'mykey') as encrypted,
  aes_decrypt(aes_encrypt('secret_data', 'mykey'), 'mykey') as decrypted;

-- ä½¿ç”¨ ENCODE/DECODE
select 
  encode('testdata','mykey') as encoded,
  decode(encode('testdata','mykey'),'mykey') as decoded;

```

æ€»ç»“ï¼š

- **åˆ†ç»„å‡½æ•°**ï¼šå¯¹å¤šè¡Œåšç»Ÿè®¡ï¼ˆSUMã€COUNTã€AVGâ€¦ï¼‰ã€‚
- **å•è¡Œå‡½æ•°**ï¼šå¯¹å•è¡Œåšå¤„ç†ï¼ˆABSã€SUBSTRINGã€NOWâ€¦ï¼‰ã€‚